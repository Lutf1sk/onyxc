import "std/io.nyx", "std/dns.nyx", "std/mem.nyx";

main :: i32(argc i32, argv u8**) {
	host : u8[] = "lutfisk.net";

	saddr : sockaddr_in_t;

	if dnslookup_ipv4("8.8.8.8", host, &saddr) {
		print("failed to resolve '");
		print(host);
		print("\n");
		goto err0;
	}

	s := socket(AF.INET, SOCK.STREAM, PF.UNSPEC);
	if s < 0 {
		print("socket creation failed\n");
		goto err0;
	}

	if connect(s, sockaddr_t*:&saddr, sizeof(sockaddr_in_t)) < 0 {
		print("connection failed\n");
		goto err1;
	}

	if write(s, "123") < 0 {
		print("write failed\n");
		goto err1;
	}

	print("connection successful\n");

	exit(0);

err1 :: here;
	close(s);
err0 :: here;
	exit(1);
};
